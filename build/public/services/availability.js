Bluebird.service("Bluebird.Services.Availability",["$resource","geolocation","_","Modernizr",function(a,b,c,d){var e=[],f=a("/api/availability");this.add=function(a){return c.isUndefined(a)?!1:c.isArray(a)?e=c.union(e,a):(e.save(a),e)},this.remove=function(a){if(c.isUndefined(a))return!1;var b=function(b){return c.isNumber(b)?e=c.without(e,c.findWhere(e,{_id:a})):c.isUndefined(b._id)?!1:e=c.without(e,b)};return c.isArray(a)?e=c.difference(e,a):b(a)},this.find=function(a){return c.isUndefined(a)?null:c.isNumber(a)?c.findWhere(e,{storeId:a}):c.isObject(a)?c.where(e,a):!1},this.query=function(a,c){var d=function(a){return c(a)}.bind(this);b.getLocation().then(function(b){var c=b.coords.latitude+","+b.coords.longitude,e=[{query:a,location:c},function(a){d(a)}];f.query.apply(this,e)})["catch"](function(a){c(new Error(a))})},this.queryByZip=function(a,b,c,d){var e=function(a){return d(a)}.bind(this);if("undefined"==typeof b)return!1;c||(c=25);var g=[{query:a,location:b,distance:c},function(a){e(a)}];f.query.apply(this,g)},this.canQuery=function(){return d.geolocation}}]);