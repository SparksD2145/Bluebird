Bluebird.States.Search={name:"search",url:"/search/:query",controller:["$scope","$routeParams","$rootScope","_","Bluebird.Services.Products",function(a,b,c,d,e){a.isLoaded=!1,a.extendedSearch=!1,a.noMatch=!1,a.results=[],a.query=function(){a.productSelected=null,d.isEmpty(b.query)&&console.error(new Error("Oops, there's nothing to search for!")),e.search(b.query,a.extendedSearch,function(b){d.isEmpty(b)?a.extendedSearch?a.noMatch=!0:a.useExtendedSearch():(a.isLoaded=!0,a.results=b,a.products=b)})},a.useExtendedSearch=function(){a.isLoaded=!1,a.extendedSearch=!0,a.query()},a.changeProduct=function(b){a.productSelected=e.find({_id:b})},a.query(),function(){function b(b){this.text=b.text,this.active=b.active,this.filter=a.filter}a.filter=function(){a.products=d.some(a.filterOptions,function(a){return a.active})?d.filter(a.results,function(b){var c=[];return a.filterOptions.online.active&&c.push(!b.availability.hasInStoreAvailability),a.filterOptions.inStore.active&&c.push(b.availability.hasInStoreAvailability),a.filterOptions.onSale.active&&c.push(b.pricing.isOnSale),a.filterOptions.hasFreeShipping.active&&c.push(b.availability.hasFreeShipping),d.all(c)}):[].concat(a.results)},a.filterOptions={inStore:new b({text:"In Store Only",active:!1}),online:new b({text:"Online Only",active:!1}),onSale:new b({text:"On Sale",active:!1}),hasFreeShipping:new b({text:"Free Shipping",active:!1})},d.each(a.filterOptions,function(a,b){a.key=b})}(),function(){function b(b){this.text=b.text,this.active=b.active,this.sort=a.sort}a.sort=function(b){if("defaultOrder"===b)a.products=[].concat(a.results);else{var c=b.split(".");a.products=d.sortBy(a.results,function(a){return a[c[0]][c[1]]})}},a.sortOptions={defaultOrder:new b({text:"Default Order"}),"identifiers.sku":new b({text:"By Sku"}),"pricing.regularPrice":new b({text:"By Regular Price"})},d.each(a.sortOptions,function(a,b){a.key=b})}()}],templateUrl:"search/search"};