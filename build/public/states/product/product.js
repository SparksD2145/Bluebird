Bluebird.States.Product={name:"product",controller:["$scope","$routeParams","$resource","_","Bluebird.Services.Products","Bluebird.Services.Availability",function(a,b,c,d,e,f){a.radius=25,a.showAvailability=function(){a.availabilityLoaded=!0},a.showGeolocationError=function(){a.geolocationUnavailable=!0},a.showProductNotFoundError=function(){a.productNotFound=!0},a.getAvailabilityByZipCode=function(){a.getAvailability(a.product,!0,angular.element("#zipcodeText").val(),angular.element("#radiusValue").val())},a.getAvailability=function(b,c,e,g){return b||(b=a.product),e||(e=a.zipcode),g||(g=a.radius),a.availabilityLoaded=!1,b.availability.hasInStoreAvailability?(a.allowAlternateAreaSearch=!0,void(c?f.queryByZip(b.identifiers.sku,e,g,function(c){return b.stores=c,b.availability.anyStores=!d.isEmpty(b.stores),a.showAvailability(),b}):f.canQuery()?f.query(b.identifiers.sku,function(c){return c instanceof Error&&a.showGeolocationError(),b.stores=c,b.availability.anyStores=!d.isEmpty(b.stores),a.showAvailability(),b}):(a.showGeolocationError(),a.showAvailability()))):(b.availability.anyStores=!1,a.showAvailability(),b)};var g=function(b){if(b.descriptions&&(b.descriptions.longDescription=d.unescape(b.descriptions.longDescription)),b.savings.percentSavings&&(b.savings.percentSavings=parseFloat(b.savings.percentSavings).toFixed(0)),b.availability.releaseDate){b.availability.releaseDate=moment(b.availability.releaseDate).calendar();var c=/invalid date.?/i;b.availability.releaseDateValid=!c.test(b.availability.releaseDate)}if(b.reviews.customerReviewAverage){for(var e=Math.ceil(parseFloat(b.reviews.customerReviewAverage)),f=[],g=1;e+1>g;g++)f.push(g);switch(b.reviews.reviewStars=f,e){case 0:b.reviews.adjective="quietly";break;case 1:b.reviews.adjective="very poorly";break;case 2:b.reviews.adjective="poorly";break;case 3:b.reviews.adjective="adequately";break;case 4:b.reviews.adjective="well";break;case 5:b.reviews.adjective="exceptionally well"}}return a.product=b,a.isLoaded=!0,a.getAvailability(b),b};if(b){try{b.query=parseInt(b.query)}catch(h){console.error(h)}var i=e.find(b.query);i?g(i):e.query(b.query,!1,function(c){if(d.isEmpty(c))e.query(b.query,!0,function(b){if(d.isEmpty(b))a.showProductNotFoundError();else{var e=d.first(c);g(e)}});else{var f=d.first(c);g(f)}})}}],templateUrl:"product/product",url:"/product/:query"};